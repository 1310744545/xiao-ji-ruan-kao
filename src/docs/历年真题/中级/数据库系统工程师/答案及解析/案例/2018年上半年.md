---  
title: 2018年上半年  
# icon: gears  
order: 991  
category:  
- 历年真题  
tag:  
- 真题  
  
# navbar: false  
# sidebar: false  
  
# breadcrumb: false  
# pageInfo: false  
# contributors: false  
# editLink: false  
# lastUpdated: false  
# prev: false  
# next: false  
comment: false  
# footer: false  
  
# backtotop: false  
---  
## 第1题 ##

【问题1】  
E1：客户 E2：医生 E3:主管  
  
本题考查采用结构化方法进行软件系统的分析与设计，主要考查数据流图（DFD)的应用，考点与往年类似。DFD是结构化分析与设计方法中面向数据流建模的工具，它将系统建模成输入、加工（处理)、输出的模型，并采用自顶向下分层且逐足细化的方式，建模不同详细程度的数据流图模型。  
首先需要建模上下文数据流图（顶层DFD)来确定系统边界。在上下文DFD中，待开发软件系统被看作一个加工，为系统提供输入数据以及接受系统输出数据的外部实体，外部实体和加工之间的输入输出即为流入和流出系统的数据流。  
在上下文DFD中确定的外部实体以及与外部实体的输入输出数据流的基础上，将上下文DFD中的加工分解成多个加工，分别识别这些加工的输入数据流以及经过加工变换后的输出数据流，建模0层DFD。根据0层DFD中加工的复杂程度进一步建模加工的内容。  
在建模分层DFD时，根据需求情况可以将数据存储建模在不同层次的DFD中。建模时，需要注意加工和数据流的使用原则，一个加工必须既有输入又有输出；数据流须和加工相关，即数据流至少有一头为加工。注意要在绘制下层数据流图时保持父图与子图之间的平衡，即：父图中某加工的输入输出数据流必须与其子图的输入输出数据流在数量和名字上相同，或者父图中的一个输入（或输出）数据流对应于子图中几个输入（或输出）数据流并集。  
本题题干描述清晰，易于分析，分析题目中所描述的内容，完成对应题目。  
本题考查上下文DFD，要求确定外部实体。在上下文DFD中，待开发系统名称“医疗管理系统”作为唯一加工的名称，外部实体为这一加工提供输入数据流或者接收其输出数据流。通过考查系统的主要功能发现，系统中涉及客户、医生、主管。根据描述（1）中“客户提交通用信息查询请求”，描述（2）中“医生提出应聘/辞职中请，交由主管进 行聘用/解聘审批”、描述（3）中“医生安排出诊时间”、描述（5）中“根据主管提交的报表查询请求”和“生成报表返回给主管”等信息，对照图1-1中E1、E2和E3相关的数据流，即可确定E1为“客户”实体，E2为“医生”实体，E3为“主管”实体。  
  
【问题2】  
D1：通用信息  
D2：预约数据  
D3：医生  
D4：医生出诊时间  
D5：药品  
  
本题要求确定图1-2 0层数据流图中的数据存储。重点分析说明中与数据存储有关的描述。说明（1）中“查询通用信息表”，可知加工“通用信息査询”需要从存储D1中根据相关检索条件查询相关通用信息，由此可知D1为“通用信息”。说明（2）中“更新医生表……删除解聘医生的出诊安排”，可知加工“医生聘用”需要向D3更新医生列表，由此可知D3为“医生”。说明（3）中“存入医生出诊时间表”、“查询在职医生及其出诊时间等预约所需数据并返回”、“在预约表中新增预约记录”，可知加工“预约处理”向存储“医生出诊时间”新增出诊时间，向“预约数据”中新增预约，从“医生”表中查询在职医生相关信息。再对应图1-2中这几个数据存储所关联的数据流名称，可知D2为“预约数据”，D4为“医生出诊时间”。说明（4）中“根据药品名称从药品数据中查询相关药品库存信息，开出药品，更新对应药品的库存……”，可知D5为“药品”。  
  
【问题3】  
![d904d6487da143288d9da90376e08dfc.jpg][]  
(注：数据流没有顺序要求)  
  
本题要求补充缺失的数据流及其起点和终点。对照图1-1和图1-2的输入、输出数据流，并未缺少外部实体和加工之间的数据流。再考查题干中的说明判定图1-2中是否缺失内部的数据流，不难发现图中缺失的数据流，具体分析如下。  
根据说明（2）中“更新所约医生出诊时间并给医生发送预约通知”可知加工预约处理（P3)发给D4(医屯出诊时间）的“更新的出诊时间”；根据说明（2）中“删除解聘医生的出诊安排”可知医生聘用（P2)向存储D4提交“删除的医生出诊安排”；根据说明(4)中“根据药品名称从药品数据中査询相关药品库存信息”可知药品管理（P4)从D5(药品）获取“药品库存信息”，并“更新对应药品的库存以及预约表中的治疗信息”可知从P4向D2(预约数据）中更新“治疗信息”。  
  
【问题4】  
预约处理分解为：安排出诊时间、预约查询、创建预约、预约反馈。  
图1-1(或父图）中某加工的输入输出数据流必须与图1-2(或子图）的输入输出数据流在数量和名字上相同；图1-1(或父图）中的一个输入（或输出）数据流对应于图1-2(或子图）中几个输入（或输出）数据流，而图1-2(或子图）中组成这些数据流的数据项全体正好是父图中的这一条数据流。  
  
在自顶向下建模分层DFD时，根据功能的粒度，可以进一步进行分解。在图1-2所示的0层数据流中，“预约处理”对应于说明（3），从中分析出需要执行的加工，进行分解，可以分为4个主要子加工——安排出诊时间、预约查询、创建预约、预约反馈。自顶向下进行建模时，需要保持数据流平衡，具体为父图中某加工的输入输出数据流必须与其子图的输入输出数据流在数量和名字上相同，或者父图中的一个输入（或输出）数据流对应于子图中几个输入(或输出)数据流并集。  


## 第2题 ##

【问题1】  
![0a4250f85f6c48aa8db980e7adf296f3.jpg][]  
  
本题考查数据库概念结构设计及向逻辑结构转换的应用。  
此类题目要求考生认真阅读题目，根据题目的需求描述，给出实体间的联系。  
根据题意由“采购完的商品交由配送员根据顾客订单组合装箱，然后交给托运公司运送。托运公司按顾客订单核对商品名称和数量，然后按顾客的地址进行运送”可知配送员、托运公司和订单三方参与运送联系，三方之间为\*:\*:\*联系。  
  
【问题2】  
(a) 收货地址  
(b) 商品数量  
(c) 商品条码  
  
根据需求描述（3）可知顾客信息包含收货地址，所以在顾客关系应该包括“收货地址”。  
根据需求描述（2）和（6）可知顾客关系和商品关系是\*:\*联系，订单应该包贪顾客所购商品的条码和数量，所以需要在订单关系模式中包含“商品数量”。  
根据需求描述（6）可知“根据顾客的订单在超市采购对应商品”，所以在代购关系里应该包括“商品条码”。  
补充内容如图中虚线所示  
关系模式：运送(运送ID，配送员工号，托运公司编号，订单ID，顾客地址，发运时间）或者说明：增加属性“顾客地址”  
  
【问题3】  
![905dc67dff4f4e0c91cf05f7da708b22.jpg][]  
  
根据题意由“允许顾客在系统中保存多组收货地址”，可知增加的“顾客地址”弱实体与顾客关系构成联系。另外，增加了顾客地址后，运送的时候要选择顾客地址，所以运送关系模式中应增加“顾客地址”。配送员、托运公司、订单和顾客地址之间构成\*:\*:\*:\*联系。  


## 第3题 ##

【问题1】  
对关系“患者”：  
(1) FD=\{身份证号→（姓名，性别，民族，出生日期），身份证号←→医保卡号\}  
或  
FD=\{医保卡号→（姓名，性别，民族，出生日期），身份证号←→医保卡号\}  
(2) 候选码：身份证号，医保卡号  
(3) 属于BCNF。  
理由：每个函数依赖左部都包含码。  
  
本题考查数据库设计方法及关系理论知识。  
关系理论通过关系的属性集和数据依赖集（函数依赖和多值依赖）对关系模式的优劣进行判定，分别是1NF、2NF、3NF、BCNF和4NF,并对不好的关系模式（仅有函数依赖时达不到BCNF,有多值依赖时达不到4NF)通过分解的方法，使其满足要求。  
由【需求描述】（1）中的“系统根据医保卡或身份证从外部医保信息库获取患者的其他详细信息，包括医保卡号、身份证号、姓名、性别、民族、出生日期等信息”可知，医保卡号和身份证号两者均能够确定患者其他的信息，即函数依赖：\{ 身份证号→（姓名，性别，民族，出生日期），身份证号←→医保卡号 \}成立。  
由题目给出的患者关系的属性集和上述函数依赖集，根据候选码求解算法，可求得该关系的候选码有两个：身份证号和医保卡号。  
根据各范式的定义，患者关系模式中各属性满足原子性，属于1NF；各非主属性，即姓名、性别、民族、出生日期都完全依赖于候选码身份证号和医保卡号，属于2NF; 各非主属性即姓名、性别、民族、出生日期都直接依赖于候选码身份证号和医保卡号，不存在传递依赖于候选码的情况，属于3NF;每个函数依赖的左部都包含候选码，属于BCNF。故患者关系模式属于BCNF。  
  
【问题2】  
对关系“病例”：  
(1) 存在问题：  
插入异常，主码为（编号，药品条码)，当药品信息未产生之前，无法插入诊断信息。  
删除异常，若只有一条药品信息，删除时会将诊断信息一并删除。  
修改异常，若修改诊断信息，则需要修改多条。  
数据冗余，诊断信息多次存储。  
(2) 不属于4NF。  
存在嵌入的多值依赖：编号→→（药品条码，服用剂量，药品数量，购买日期）  
(3) 分解后的关系模式：  
病例1 (编号，药品条码，服用剂量，药品数量，购买日期）∈4NF  
病例2 (编号，患者身份证号，主治医生编号，病情描述，诊断结论，诊断日期）∈BCNF  
  
由【需求描述】（1）中的“病例同时包含诊断和处方信息……处方中一般会有多种药品”可知，病例关系模式存在数据冗余和三种更新异常。  
由题目给定的数据依赖集中包含多值依赖，且为嵌入式的多值依赖，根据4NF定义，病例关系模式不属于4NF。  
由4NF分解算法，计对多值依赖：编号→→(药品条码，服用剂量，药品数量，购买日期)，将其中所有属性构成关系模式：病例1(编号，药品条码，服用剂量，药品数量， 购买日期)，数据依赖集DD1=\{(编号，药品条码）→（服用剂量，药品数量，购买日期)，编号→→（药品条码，服用剂量，药品数量，购买日期）\}，其中多值依赖为平凡的多值依赖，属于4NF。从原关系中去掉多值依赖的右部，分解出另一关系模式：病例2(编号，患者身位证号，主治医师编号，病情描述，诊断结论，诊断日期），函数依赖集FD2=\{编号→（患者身份证号，主治医生编号，病情描述，诊断结论，诊断日期）\}，属于BCNF。  
  
【问题3】  
需要医生、购药、病例2(注：由【问题2】分解出的另一关系名）三个关系。  
购药关系模式增加“主治医生编号”和“医生姓名”属性，可以减少査询关系模式，  
减少连接操作提高查询效率。  
  
根据题目要求“统计每名医生（编号和姓名）每天接诊的患者所购买的各个药品的条码和数量”，需要根据购药关系模式中的病例编号，在分解中的另一关系模式病例2中査找主治医生编号，再由主治医生编号在医生表中查找医生姓名。故完成该统计需要上述三个关系模式。影响此查询效率的主要因素是涉及多表查询，在逆规范化允许的情况下，在购药关系模式中增加主治医生编号和医生姓名，即可从一个表中完成此查询，以少量的数据冗余为代价提高查询效率。  


## 第4题 ##

【问题1】  
(a) PRIMARY KEY  
(b) REFERENCES USERS(Userid)  
(c) REFERENCES Cars(CId)  
(d) DEFAULTGETDATE()  
  
本题考査数据库SQL编程的应用。  
根据题目描述，租用记录BORROWS (BRId, Userid, CId,\_ STime, ETime)的各属性分别表示租用编号、用户编号、汽车编号、租用时间、归还时间，其中BRId为主键，Userid和Cid为外键。另外，租用时间默认为系统当前时间。因此创建租用记录表的完整SQL语句为：  
![23795c95791b4ab0a6757134a285aea3.jpg][]  
  
【问题2】  
(e) AFTER  
(f) ROLLBACK  
(g) GETDATE()  
(h) BORROWS.Userld = nrow.UserID  
  
跟据题意，当从用户余额中扣除租金（修改用户当日余额）时，触发器执行，该触发器应为AFTER触发器。若余额不足，不扣除当日租金，即需要回滚，同时自动向不良记录表中加入一条记录，记录中的Bid取值由Userld+系统当前日期构成，Btime采用GETDATE()函数取系统当前时间。完整的触发器Bad\_TRG SQL语句如下：  
![9e50bbbd75994f8db6ed45e3e92bca08.jpg][]  
  
【问题3】  
(i) BADS\_Detail(UserId,Name,BRId,Cld,Stime,Etime,total)  
(j) SUM(CPrice)  
(k) USERS.Userld  
(l) SUM(CPrice)&gt;200  
  
根据题意，不良记录详单视图BADS\_Detail,包括属性有Userid、Name、BRId、Cld、Stime、Etime和total(表示未缴纳租金综合），统计每次租车产生的不良记录租金费用总和大于200的记录。完整的创建视图BADS\_Detail的SQL语句如下：  
![5abe0fdcf8ce47a2ba22568fc928b126.jpg][]  
  
【问题4】  
(m) CARS.Ctype='A8'  
(n) BADS.BRId=BORROWS.BRId  
(l) NAME DESC  
  
根据题意，查询汽车型号为“A8”且不良记录次数大于等于2的用户，输出用户编号、姓名，并按用户姓名降序排序，完整的查询SQL语句如下：  
![d4d00d043ebb42f7acf85b3bca06f414.jpg][]  


## 第5题 ##

【问题1】  
X=8  
不一致性：丢失修改。  
  
本题考查事务并发控制技术及编程应用。  
事务的并发控制涉及理论和编程实现两部分，本题目前两者结合在一起，考查应试者的理论与实践相结合的应用能力。  
由题目所给的事务调度图可知，两个事务T1、T2所读取的当前X值均为10,两个事务中的变量a均为局部变量且相互不影响，事务T1将变量a(=9)的值写入X之后，事务T2将变量a(=8)的值写入X，最终X的值为8，事务T1对X的修改被事务T2所覆盖，事务T1的修改丢失了，即此并发调度产生了丢失修改的不一致性。  
  
【问题2】  
![35d4fd0d7b9a4be8978f21d4c005931f.jpg][]  
  
本题中的两个事务均为读写事务，根据题目要求只使用独占锁指令Xlock()进行加锁，根据两段锁协议和【问题1】中的事务调度图，事务T1的第一条指令“a←Read(X)” 前应加Xlock(X)指令提出加锁请求，此时数据项X上没有锁，加锁指令被响应并能成功加锁，继续执行事务T1的“a←Read(X)”指令；下一时刻事务T2的指令“a←Read(X)”被响应前，应由加锁指令Xlock(X)提出请求，与数据项X上事务T1所加的排它锁冲突，请求不被执行，事务T2处于等待状态，系统继续执行事务T1直至“Write(X，a)”指令被执行后，加入解锁指令Unlock(X)释放其在数据项X上所加的排它锁，之后再响应T2的加锁请求，此时没有锁冲突，因此加锁成功，继续执行T2的后续指令直至“Write(X，a)”后加入解锁指令Unlock(X)释放锁。  
  
【问题3】  
(a) read uncommited  
(b) qty - :AmountBuy  
(c) commit;return 0;  
  
本题目以存储过程的形式编程实现销售事务，对比【问题1】所示的事务增加了销售记录的写入。  
空缺（a）处是要完成事务隔离级别的设置。销售事务实现的是数据写入，要保证不产生丢失修改的不一致性，四个隔离级别中的最低级别read uncommited即可解决丢失修改问题，从提高并发性考虑，选此级别。  
空缺（b）处为库存量的修改，根据程序所给的变量使用规则（变量名前加冒号）和存储过程的形参定义及在上文INSERT指令中的使用，可知此处应填写qty - :AmountBuy,即当前库存量减去销售数量。  
空缺（c）处为事务中所有操作执行完之后，事务正确结束的结点，应提交事务并返回执行状态。由程序中的错误状态返回值为负数值及默认规则，此处返回值宜设为0。  



[d904d6487da143288d9da90376e08dfc.jpg]: https://www.xkxxkx.cn/file/exam/software/数据库系统工程师/案例/第1题/d904d6487da143288d9da90376e08dfc.jpg
[0a4250f85f6c48aa8db980e7adf296f3.jpg]: https://www.xkxxkx.cn/file/exam/software/数据库系统工程师/案例/第2题/0a4250f85f6c48aa8db980e7adf296f3.jpg
[905dc67dff4f4e0c91cf05f7da708b22.jpg]: https://www.xkxxkx.cn/file/exam/software/数据库系统工程师/案例/第2题/905dc67dff4f4e0c91cf05f7da708b22.jpg
[23795c95791b4ab0a6757134a285aea3.jpg]: https://www.xkxxkx.cn/file/exam/software/数据库系统工程师/案例/第4题/23795c95791b4ab0a6757134a285aea3.jpg
[9e50bbbd75994f8db6ed45e3e92bca08.jpg]: https://www.xkxxkx.cn/file/exam/software/数据库系统工程师/案例/第4题/9e50bbbd75994f8db6ed45e3e92bca08.jpg
[5abe0fdcf8ce47a2ba22568fc928b126.jpg]: https://www.xkxxkx.cn/file/exam/software/数据库系统工程师/案例/第4题/5abe0fdcf8ce47a2ba22568fc928b126.jpg
[d4d00d043ebb42f7acf85b3bca06f414.jpg]: https://www.xkxxkx.cn/file/exam/software/数据库系统工程师/案例/第4题/d4d00d043ebb42f7acf85b3bca06f414.jpg
[35d4fd0d7b9a4be8978f21d4c005931f.jpg]: https://www.xkxxkx.cn/file/exam/software/数据库系统工程师/案例/第5题/35d4fd0d7b9a4be8978f21d4c005931f.jpg
