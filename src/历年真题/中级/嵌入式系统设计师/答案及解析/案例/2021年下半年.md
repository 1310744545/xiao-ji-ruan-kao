---  
title: 2021年下半年  
# icon: gears  
order: 988  
category:  
- 历年真题  
tag:  
- 真题  
  
# navbar: false  
# sidebar: false  
  
# breadcrumb: false  
# pageInfo: false  
# contributors: false  
# editLink: false  
# lastUpdated: false  
# prev: false  
# next: false  
comment: false  
# footer: false  
  
# backtotop: false  
---  
## 第1题 ##

【问题1】  
A,B,F,K  
【分析】  
FT-2000/4是飞腾信息技术有限公司的全国产化的基础电子元器件，是一款面向桌面应用的高性能通用处理器。FT-2000/4集成了4个64位高性能核,主频2.6~3.0GHz,工作温度范围是-40℃~85℃，内置密码加速引擎，集成系统级安全机制，能够满足复杂应用场景下的性能需求和安全可信需求。  
FT-2000/4中每2个高性能处理器核构成1个处理器核簇(Cluster),并共享L2 Cache。处理器核通过片内高速互联网络及相关控制器与存储系统、I/O系统相连。FT-2000/4存储系统包含Cache子系统和DDR,I/O系统包含PCIE、高速IO子系统、千兆位以太网GMAC和低速I/O子系统。  
FT-2000/4的主要技术指标如下:  
(1)功能指标，具体包括：  
兼容ARM v8体系结构，支持64位和32位指令。  
支持单精度、双精度浮点运算指令。  
支持ASIMD处理指令。  
支持基于域隔离的安全机制。  
支持可信启动。  
(2)结构指标，具体包括：  
集成4个FTC663核。  
L2 Cache:每个Cluster内有2MB,共4MB。  
L3 Cache:分为8个Bank,共4MB。  
集成2个DDR4-3200通道，支持对DDR存储数据进行实时加密。  
集成34 Lanes PCIe 3.0接口:2个X16(每个可拆分成2个X8),2个X1。  
集成2个千兆Ethernet接口(RGMII),支持10/100/1000Mbps自适应。  
集成1个SD卡控制器，兼容SD2.0规范。  
集成1个HDA(HD-Audio),支持音频输出,可同时支持最多4个Codec。  
集成多种密码加速引擎。  
集成4个UART,1个LPC Master,32个GPIO,4个I2C,1个QSPI,2个通用SPI,2个WDT,1个RTC,16个外部中断(和GPIO共用IO)。  
集成温度传感器。  
集成128KB On Chip Memory。  
集成ROM作为片内可信启动根。  
FT-2000/4功能特征总结如表1-1所示。  
![b26082b4d576434592e85245be5c3b99.jpg][]  
综上所述，FT-2000/4支持单精度、双精度浮点运算指令。所以，A中的不支持双精度浮点运算指令的说法是错误的。  
FT-2000/4支持ASIMD处理指令,而不是CISC处理指令,所以B是错误的。  
FT-2000/4集成2个千兆Ethernet接口(RGMII),支持10/100/1000Mbps自适应,所以F也是错误的。  
FT-2000/4集成128KB On Chip Memory,而不是512KB On Chip Memory,所以K也是错误的。  
  
【问题2】  
(1)引入Cache结构的目的是解决主存与CPU之间的速度匹配问题，而采用虚拟存储结构的目的是解决  
主存容量不足的问题。  
(2)R= Tm/Tc= 4;Tc= Tm/4= 200/4 = 50ns 。  
平均访问时间： T = H × Tc \+ (1-H) × Tm = 0.98 × 50ns + (1 - 0.98) × 200ns = 53ns  
Cache-主存的效率: e = Tc/Ta= 50ns/53ns = 94.34%  
【分析】  
(1)FT-2000/4采用层次结构的存储系统，Cache和虚拟存储的不同在于：  
Cache是存在于主存与CPU之间的一级存储器，主要由Cache存储体、地址转换部件、替换部件三大部分组成。Cache由静态存储器芯片SRAM组成，容量比较小，但速度比主存高得多，接近于CPU的速度。Cache可以节省CPU从外部存储器读取指令和数据的时间，在CPU执行程序过程中，需要从主存取指令或写数据时，先检查Cache中有没有要访问的信息，若有，就直接在Cache中读写，而不用访问主存储器。综上所述，引入Cache结构的目的是解决主存与CPU之间的速度匹配问题。  
虚拟存储器在具有层次结构存储器的计算机中，自动实现部分装入和部分替换功能，能从逻辑上为用户提供一个比物理存储容量大得多的，可寻址的“主存储器”(地址空间)。虚拟存储区的容量与主存大小无关，而受限于计算机的地址结构和可用磁盘容量。根据所用的存储器映像算法，虚拟存储器管理方式主要有段式、页式和段页式三种。采用虚拟存储结构的目的是解决主存容量不足的问题。  
(2)系统主存周期是Cache的4倍,主存存取周期Tm为200ns,则Cache的存取周期 Te= Tm/4 = 200/4 = 50ns。  
根据公式、Cache命中率H=0.98,Cache-主存的平均访问时间Ta为  
Tn= H×To\+(1-H)×Tm =0.98× 50ns+(1-0.98)× 200ns = 53ns  
Cache-主存的效率为Cache的存取周期除以平均存取周期。  
c = To/Tn= 50ns/53ns = 94.34  
  
【问题3】  
(1)识别中断源  
(2)设置新的屏蔽字  
(3)执行中断服务程序主体  
(4)关中断  
【分析】  
中断是指计算机系统运行时，出现来自处理机以外的任何现行程序不知道的事件，CPU 暂停现行程序，转去处理这些事件，待处理完毕，再返回原来的程序继续执行，这个过程称为中断，这种控制方式称为中断控制方式。  
请求CPU中断的设备或事件称为中断源，根据中断源的不同类别，可以把中断分为内中断和外中断两种。中断的处理过程一般按如下步骤进行：  
(1)关中断：进入不可再次响应中断的状态，由硬件自动实现。  
(2)保存断点：为了在中断处理结束后能正确地返回到中断点，在响应中断时，必须把当前的程序计数器PC中的内容(即断点)保存起来。  
(3)识别中断源，转向中断服务程序：在多个中断源同时请求中断的情况下，本次实际响应的只能是优先权最高的那个中断源，所以，需要进一步判断中断源，并转入相应的中断服务程序入口。  
(4)保存现场和屏蔽字：进入中断服务程序后，首先要保存现场，现场信息一般指的是程序状态字、中断屏蔽寄存器和CPU中某些寄存器的内容。保存旧的屏蔽字是为了中断返回前恢复屏蔽字，设置新的屏蔽字是为了实现屏蔽字改变中断优先级或控制中断的产生。  
(5)开中断：因为接下去就要执行中断服务程序，开中断将允许更高级中断请求得到响应，实现中断嵌套。  
(6)执行中断服务程序主体：不同中断源的中断服务程序是不同的，实际有效的中断处理工作是在此程序段中实现的。  
(7)关中断：是为了在恢复现场和屏蔽字时不被中断打断。  
(8)恢复现场和屏蔽字；将现场和屏蔽字恢复到进入中断前的状态。  
(9)中断返回：中断返回是用一条IRET指令实现的，它完成恢复断点的功能，从而返回到原程序执行。  
进入中断时执行的关中断、保存断点操作和识别中断源是由硬件实现的，它类似于一条指令，但它与一般的指令不同，不能被编写在程序中。  


## 第2题 ##

【问题1】  
(1) B  
(2) 0x42  
【分析】  
在电源设计中，依据LTM4616EV手册描述，该芯片在5V供电情况下，输出电压可以在0.6V~5V之间任意调节，该系统设计中FPGA和DSP的内核电压均由该芯片提供。根据题目所给出的信息： VREF= 0.596,RFB为芯片外部的调节电阻，若期望Vout输出1.2V，依据给定公式可以计算出电阻阻值为10千欧。  
根据题目给出的 0x04号寄存器各个 Bit位的含义，若该系统的 HDMI视频输入线 P35-P0配置为U/CrCb/B、Y/G、V/R,晶振频率选择为28.63636MHz,可以推断出该寄存器的配置值应该为0x42。  
  
【问题2】  
J1跳线帽：管脚2和3  
J2跳线帽：管脚1和2  
【分析】  
FPGA支持三种启动方式,分别是JTAG、QSPI Flash和Micro SD,需要利用FPGA的五个管脚MIO\[6：2\]来配置，依据对应的配置模式表，若选用QSPI Flash启动，J1跳线帽应该连接管脚2和3，以保证MIO4为低电平，J2跳线帽应该连接管脚1和2，以保证MIO5为高电平。  
  
【问题3】  
(1) 1920×1080×60×24=2.986Gbps  
(2) 可以满足  
【分析】  
根 据 题 目 给 出 的 信 息 ， 实 时 传 输 2 路 1080p 视 频 数 据 的 带 宽 要 求 计 算 方 式 为 ：1920×1080×60×24=2.986Gps。  
从计算可以看出，所需要的带宽可以满足要求。(2.986Gps小于5Gps)  
  
【问题4】  
(1) C  
(2) E  
(3) A  
(4) I  
【分析】  
由题目给出的设置流程，ADV7513的初始化过程描述如下：  
FPGA对ADV7513的时钟等先进行初始化,当ADV7513未连接HDMI接收设备时,ADV7513切换为掉电状态，此时ADV7513只有IIC模块和中断检测模块处于工作状态，FPGA 通过读取地址为0x42的寄存器来获取ADV7513的HPD检测状态(HDMI外接设备)。当连接HDMI外接设备时,HPD引脚被拉高,触发ADV7513的HPD中断,ADV7513会被唤醒。ADV7513被唤醒后,FPGA需要向ADV7513的断电寄存器0x41的上电标志位写入0,以此启动ADV7513的全部功能。  
根据题意可以得到流程图中的(1)~(4)依次是:ADV7513时钟初始化、读取ADV7513的0x42寄存器、检查ADV7513的HPD位是否有外接设备、给ADV7513的0x41寄存器上电标志位写0。  


## 第3题 ##

【问题1】  
(1) 3  
(2) 3  
(3) 5  
【分析】  
此题目主要考查对语句覆盖、分支覆盖和MC/DC覆盖概念的掌握以及实际分析应用。  
语句覆盖要求设计适当数量的测试用例，运行被测程序，使得程序中每一条语句至少被运行一遍，语句覆盖在测试中主要发现错误语句。  
分支覆盖要求设计适当数量的测试用例，运行被测程序，使得程序中每个真值分支和假值分支至少执行一次，分支覆盖也称判定覆盖。  
修正判定条件覆盖(MC/DC)要求设计适当数量的测试用例，保证在一个程序中每一种输入输出至少得出现一次，在程序中的每一个条件必须产生所有可能的输出结果至少一次，并且每个判断中的每个条件必须能够独立影响一个判断的输出，即在其他条件不变的前提下仅改变这个条件的值，而使判断结果改变。  
按照上述语句覆盖要求，语句覆盖就要使得问题1中给定算法中所有语句执行一次，问题1中有三个语句块，如下所示。  
![74bae0cb55f54b42b6687859f1cedae5.jpg][]  
故为了使问题1中给定算法的三个语句块各执行一次，最少需要3个测试用例来满足语句覆盖要求。  
按照上述分支覆盖要求，分支覆盖需要程序中每个判定的真值分支和假值分支至少执行一次。对问题1中的判定条件进行分析，算法中存在两个判定条件，需要分别取每个判定的真值分支和假值分支，即从理论上需要4个测试用例来满足分支覆盖要求。但是，由于第一个判定的假分支中包含了第二个判定条件的真假分支，当满足第一个判定的假分支时，同时可满足第二个判定条件的真或假分支，可减少一个测试用例，故问题1最少需要3个测试用例来满足分支覆盖要求。  
按照上述MC/DC覆盖要求，即每个判定条件中的每个条件必须能够独立影响一个判定的输出。对问题1中给定算法的两个判定条件进行分析，第一个判定有两个条件，两个条件共有四种组合,即TT(TRUE和TRUE)、TF(TRUE和FALSE)、FT(FALSE和TRUE)和FF(FALSE和FALSE)；第二个判定也有两个条件，两个条件共有四种组合，即TT、TF、FT和FF。由于第一个判定中的两个条件为逻辑或条件，当前一个条件为TRUE时，其整个判定值确定为TRUE，后一个条件的真或假均不能独立影响整个判定的输出，所以只需要TX(X表示后一个条件为TRUE或FALSE都可以)、FT和FF三种情况就可以；第二个判定中的两个条件为逻辑与条件，当前一个条件为FALSE时，其整个判定值确定为FALSE，后一个条件的真或假均不能独立影响整个判定的输出，所以只需要TT、TF和FX(X表示后一个条件为TRUE或FALSE都可以)三种情况就可以满足要求，即从理论上需要6个测试用例来满足MC/DC覆盖要求。但是，当第一个判定条件为假(即取FX时)时，同时可满足第二个判定条件的真分支(即取TT)或假分支(即取TF或FX)，也就是第一个判定和第二个判定可共用一组用例，故问题1最少需要5个测试用例来满足MC/DC覆盖要求。  
  
【问题2】  
(1) Fail  
(2) 不正常  
(3) Fail  
(4) 释放流数据发送逻辑ID  
(5) 不正确  
(6) 发送流数据  
【分析】  
此问题主要考查考生阅读并理解软件流程图的能力，以及根据对流程图的理解，运用路径覆盖方法设计测试用例的能力。按照流程图提供的软件功能，对照表3-2中的已知信息和提示信息，完成表3-2中的问题。  
(1)中的输入为“设备句柄非法，设备状态正常”，根据流程图中第一个判定框的条件可知，当设备句柄非法，则不管设备状态正常与否，将返回Fail，故预期输出为返回Fail。  
(2)中的输入为“设备句柄合法，设备状态未知”，但是输出为“返回Fail”，根据流程图中第一个判定框和第二个判定框可知，如果设备句柄合法，则必须设备状态不正常，才能返回Fail，故可判断设备状态为不正常。  
(3)中的输入为“设备句柄非法，设备状态不正常”，根据流程图中第一个判定框的条件可知，当设备句柄非法，则不管设备状态正常与否，将返回Fail，故预期输出为返回Fail。  
(4)中的输入为“设备句柄合法，设备状态正常，待发送数据流指针不为空，发送缓冲区标识正确”，根据流程图中第一个判定框、第二个判定框、第三个判定框和第四个判定框可知，第一个和第二个判定框均为“是”分支，第三个判定框为“否”分支，程序运行不能到达第四个判定框，故预期输出为“释放流数据发送逻辑ID，返回Fail”。  
(5)中的输入为“设备句柄合法，设备状态正常，待发送数据流指针为空，发送缓冲区标识状态未知”，但是输出为“释放流数据发送逻辑ID，返回Fail”，根据流程图中第一个判定框、第二个判定框、第三个判定框和第四个判定框可知，第一个、第二个和第三个判定框均为“是”分支，要使预期输出为“释放流数据发送逻辑ID，返回Fail”，则第四个判定框必须为“否”分支才可以，故发送使用的缓冲区标识不正确。  
(6)中的输入为“设备句柄合法，设备状态正常，待发送数据流指针为空，发送缓冲区标识正确”，根据流程图中第一个判定框、第二个判定框、第三个判定框和第四个判定框可知，四个判定框均为“是”分支，从流程图可以得出预期输出为“发送流数据，返回OK”。  
  
【问题3】  
(1) 5  
(2) 黑盒测试方法或②  
【分析】  
此题第一问考查圈复杂度的概念及理解。在软件测试的概念里，圈复杂度(Cyclomatic complexity)用来衡量一种代码的复杂程度，数量上表现为独立线性路径条数，即合理的预防错误所需测试的最少路径条数，圈复杂度大说明程序代码可能质量低且难于测试和维护，根据经验，程序的可能错误和高的圈复杂度有着很大关系。  
嵌入式软件中通常使用圈复杂度来衡量程序的可维护性，一般要求圈复杂度不大于10。圈复杂度计算方法有：  
(1)V(G)=e-n+2，其中，e表示控制流图中边的数量，n表示控制流图中节点的数量，包括起点和终点。  
(2)V(G)=判定节点数+1。  
(3)V(G)=R，其中，R代表平面被控制流图划分的区域数。  
将题目给定流程图简化后的图形如下所示：  
![9ea9a98259544923a8e281edbdd169bf.jpg][]  
根据第一种计算方法,上图中e为9,n为6,故V(G)=e-n+2=9-6+2=5。  
根据第二种计算方法，上图中判定节点为 2、 3、 4和 5，共 4个判定节点，故 V(G)=判定节点数+1=4+1=5。  
根据第三种计算方法，上图中被控制流图划分的区域数为图中(1)、(2)、(3)、(4)和(5)所示区域,共5块区域,故V(G)=R=5。  
此题第二问考查白盒测试方法和黑盒测试方法的概念，同时也考查概念的应用情况。  
白盒测试也称结构测试、逻辑测试或基于程序的测试，这种测试应了解程序的内部构造，并且根据内部构造设计测试用例。  
黑盒测试又称功能测试、数据驱动测试或基于需求规格说明的测试，这种测试不必了解被测对象的内容情况，而依靠相关文档中功能的说明来设计测试用例。  
由于白盒测试方法与黑盒测试方法的概念定义较多，此题中白盒测试概念中只需给出根据程序内部构造设计测试用例的关键词即可，黑盒测试概念中只需给出依靠相关文档给出的功能设计测试用例即可。  
问题2中设计测试用例时，只是根据设计算法，进行功能方面的测试，而不了解程序的内部构造，按照黑盒测试方法的概念，确定问题2使用了黑盒测试方法。  


## 第4题 ##

【问题1】  
(1)当多个CPU或者多个内核共享一个共同存储器资源时，会出现在高速缓存中的数据不一致的情况，产生Cache一致性问题。  
(2)Cache一致性问题主要靠硬件的方法解决。  
【分析】  
高速缓冲存储器一致性(Cache Coherence)也称缓存一致性、高速缓存间一致性，是指在采用层次结构存储系统的计算机系统中，保证高速缓冲存储器中数据与主存储器中数据相同的机制。在一个系统中，当许多不同的设备共享一个共同存储器资源，在高速缓存中的数据不一致就会产生问题。这个问题在有数个CPU的多处理机系统中特别容易出现。  
单核Cache中每个Cache line有2个标志,即dirty和valid标志,它们很好地描述了Cache 和Memory(内存)之间的数据关系(数据是否有效，数据是否被修改)，而在多核处理器中，多个核会共享一些数据，MESI协议就包含了描述共享的状态。  
在MESI协议中,每个Cache line有4个状态,可用2个bit表示,它们分别是:  
M(Modified)：这行数据有效，数据被修改了，和内存中的数据不一致，数据只存在于本Cache中。  
E(Exclusive)：这行数据有效，数据和内存中的数据一致，数据只存在于本Cache中。  
S(Shared)：这行数据有效，数据和内存中的数据一致，数据存在于很多Cache中。  
I(Invalid):这行数据无效。  
在该协议的作用下，虽然各Cache控制器随时都在监听系统总线，但能监听到的只有读未命中、写未命中以及共享行写命中三种情况。读监听命中的有效行都要进入S态并发出监听命中指示，但M态行要抢先写回主存；写监听命中的有效行都要进入I态，但收到RWITM时的M态行要抢先写回主存。总之监控逻辑并不复杂，增添的系统总线传输开销也不大，但MESI协议却有力地保证了主存块脏拷贝在多Cache中的一致性，并能及时写回，保证Cache 主存存取的正确性。  
  
【问题2】  
A、C、D、F、G、H  
或者  
UART、SPI、I2C、CAN、SATA、USB  
【分析】  
任何一个处理器都要与一定数量的部件和外围设备连接，但如果将各部件和每一种外围设备都分别用一组线路与CPU直接连接，那么连线将会错综复杂，甚至难以实现。为了简化硬件电路设计、简化系统结构常用一组线路，配置以适当的接口电路，与各部件和外围设备连接，这组共用的连接线路被称为总线。采用总线结构便于部件和设备的扩充，尤其制定了统一的总线标准则容易使不同设备间实现互连。  
计算机通信方式可以分为并行通信和串行通信，相应的通信总线被称为并行总线和串行总线。  
并行通信速度快、实时性好，但由于占用的口线多，不适于小型化产品；而串行通信速率虽低，但在数据通信吞吐量不是很大的微处理电路中则显得更加简易、方便、灵活。串行通信一般可分为异步模式和同步模式。随着微电子技术和计算机技术的发展，总线技术也在不断地发展和完善，而使计算机总线技术种类繁多，各具特色。下面仅对常见的一些串行总线加以介绍。  
通用异步收发传输器(Universal Asynchronous Receiver/Transmitter),通常称作UART。它将要传输的资料在串行通信与并行通信之间加以转换。作为把并行输入信号转成串行输出信号的芯片，UART通常被集成于其他通信接口的连结上。具体实物表现为独立的模块化芯片，或作为集成于微处理器中的周边设备。一般是RS-232C规格的，与类似Maxim的MAX232之类的标准信号幅度变换芯片进行搭配，作为连接外部设备的接口。  
串行外围设备接口SPI(Serial Peripheral Interface)总线技术是一种同步串行接口。绝大多数MCU(微控制器)都配有SPI硬件接口。SPI总线是一种三线同步总线，因其硬件功能很强，所以，与SPI有关的软件就相当简单，使CPU有更多的时间处理其他事务。  
I²C(Inter-IC)总线是近年来在微电子通信控制领域广泛采用的一种新型总线标准。它是同步通信的一种特殊形式，具有接口线少，控制方式简化，器件封装形式小，通信速率较高等优点。在主从通信中，可以有多个I²C总线器件同时接到I²C总线上，通过地址来识别通信对象。  
CAN总线是为解决现代汽车中众多的控制与测试仪器之间的数据交换而开发的一种串行数据通信协议，它是一种多主总线，通信介质可以是双绞线、同轴电缆或光导纤维。通信速率最高可达1Mbps。  
SATA(Serial ATA)，即串行ATA，主要功能是用作主板和大量存储设备(如硬盘及光盘驱动器)之间的数据传输，由于采用串行方式传输数据而得名，还具有结构简单、支持热插拔的优点。SATA总线使用了嵌入式时钟频率信号，具备了比以往更强的纠错能力，能对传输指令(不仅是数据)进行检查，如果发现错误会自动矫正，提高了数据传输的可靠性。SATA和以往最明显的分别，是用上了较细的排线，有利于机箱内部的空气流通，增加了整个平台的稳定性。  
通用串行总线USB(Universal Serial Bus)是一种新型接口标准。它基于通用连接技术,实现外设的简单快速连接，达到方便用户、降低成本、扩展PC连接外设范围的目的。它可以为外设提供电源，而不像普通的使用串、并口的设备需要单独的供电系统。另外，快速是USB技术的突出特点之一，USB的最高传输率可达12Mbps，比串口快100倍，比并口快近10倍，而且USB还能支持多媒体。  
  
【问题3】  
(1) 512  
(2) FFFFFFFF  
【分析】  
存储地址空间是指对存储器编码(编码地址)的范围。所谓编码就是对每一个物理存储单元(一个字节)分配一个号码，通常叫作“编址”。分配一个号码给一个存储单元是为了便于找到它，完成数据的读写，这就是地址空间，也称为寻址空间。CPU在操控物理存储器的时候，把物理存储器都当作内存来对待，把它们总的看作一个由若干存储单元组成的逻辑存储器，这个逻辑存储器就是我们所说的内存地址空间。有的物理存储器被看作一个由若干存储单元组成的逻辑存储器，每个物理存储器在这个逻辑存储器中占有一个地址段，即一段地址空间。CPU在这段地址空间中读写数据，实际上就是在相对应的物理存储器中读写数据。  
存储容量是指计算机存储器所能存储的二进制信息的总量，它反映了计算机处理信息时容纳数据量的能力。存储容量以字节为单位，每1024字节称为“1KB”，每1024KB字节称为“1MB”，每1024MB字节称为“1GB”。因此，计算机的内存存储容量的计量单位是字节。  
Flash 存储器的地址空间为0x000 00000000~0x000 1FFFFFFF,存储容量是0x20000000,即512MB。  
Memory 空间是2GB,即0x80000000,地址空间的起始地址是0x000 80000000,那么最大地址为0x000 80000000+0x80000000-1=0x000 FFFFFFFF。  
  
【问题4】  
(1) PCIE设备的配置空间用于支持即插即用  
(2) 32  
(3) 0x00018004  
【分析】  
PCIE总线标准是一种将系统外部设备连接起来的高速串行总线标准。每个PCIE设备都有自己的配置空间，用于支持即插即用，使之满足现行的系统配置结构。PCIE 配置空间是容量为256字节并具有特定结构的地址空间。每个设备都必须配置该区的寄存器，该区中的各个字段用来唯一地识别设备。为了实现即插即用，系统可根据硬件资源的使用情况，为PCIE 设备分配新的资源。  
PCIE设备驱动程序在初始化过程中，完成寻找硬件设备的工作。在初始化过程中，使用配置空间中的器件识别号(Device ID)和厂商识别号(Vendor ID)，通过遍历总线上的所有设备，寻找到指定的设备，并获取设备的总线号、设备号与功能号。通过这些配置信息，可以在系统中寻址该设备的资源配置列表。驱动程序需要从配置空间获取硬件的参数。硬件设备的中断号、端口地址的范围(I/O)方式、存储器的地址与映射方式等，都可以从硬件资源列表数据结构中获取。  
PCIE配置数据中设备号是15位到19位，那么PCIE总线理论上可以挂接的设备号从00000b到11111b,最多32个设备。  
PEU1 C0设备的总线号为0，设备号为3，当功能号为0时，如果配置空间内偏移0x4，按照表4-3格式进行组织配置的数据为0000000000000011000000000000100,即0x00018004。  
![ebc77ddc05fd4b98a59bcb61fbe20f19.jpg][]  


## 第5题 ##

【问题1】  
(1) 0x78  
(2) 0x56  
(3) 0x34  
(4) 0x12  
(5) 0x12  
(6) 0x34  
(7) 0x56  
(8) 0x78  
【分析】  
大端模式，是指数据的高字节保存在内存的低地址中，而数据的低字节保存在内存的高地址中，这样的存储模式有点类似于把数据当作字符串顺序处理，即地址由小向大增加，而数据从高位往低位放，这和我们的阅读习惯一致。  
小端模式，是指数据的高字节保存在内存的高地址中，而数据的低字节保存在内存的低地址中，这种存储模式将地址的高低和数据位权有效地结合起来，高地址部分权值高，低地址部分权值低。  
对于一个32bit的十六进制整数0x12345678,Big-endian模式下,低地址存放高位,具体如下：  
低地址  
buf\[0\] (0x12) ---高位字节  
buf\[1\] (0x34)  
buf\[2\] (0x56)  
buf\[3\] (0x78) ---高位字节  
高地址  
Little-endian模式下,低地址存放低位,具体如下:  
低地址  
buf\[0\] (0x78)---高位字节  
buf\[1\] (0x56)  
buf\[2\] (0x34)  
buf\[3\] (0x12)---高位字节  
高地址  
从地址0x8000开始存放数据0x12345678,如表5-1所示。  
![0523d9add5984681893d46e7cced19ce.jpg][]  
  
【问题2】  
(1) int(\*process)(int arg1,int arg2);  
(2) int(\*ProcAction)(int argl,int arg2);  
(3) ProcAction = dev\_tab\[place\].process;  
(4) ret=ProcAction(argl,arg2);  
【分析】  
该问题考查对C语言中函数指针变量的理解和用法。通常在C语言中，可以用指针变量指向整型变量、字符串、数组、结构变量，也可以指向一个函数，对指针的用法非常灵活，也很容易出错。其中，函数指针变量是较高级的用法。  
一个函数在编译时被分配给一个入口地址，这个入口地址就称为函数的指针。可以用一个指针变量指向函数，然后通过该指针变量调用此函数。  
本题已将使用变量指向函数编写设备驱动程序的大部分给出，只需在对函数指针变量的声明和引用处，给出正确的用法即可。  
按照题意,结构体类型TYP\_DEV\_TAB应定义为:  
typedef struct \{  
int fd;  
int(\*process)(int arg1,int arg2);  
\}TYP\_DEV\_TAB;  
将 manage\_device 程序补充完整,具体如下:  
void manage\_device( int devid, int arg1, int arg2)  
\{  
int place;  
int ret;  
int (\*ProcAction)(int arg1,int arg2);  
for(place=0;place&lt;50;place++) \{  
if( dey\_tab 〔 place 〕,\_fd== devid)\{  
ProcAction= dev tab\[ place\], process;  
break;  
\}  
)  
if(place&gt;=50)  
printf("NO DEVICE fd =%d\\n",devid);  
ret =ProcAction(arg1,arg2);  
if(ret!=NOERROR)  
printf("DEVICE %d error!",devid);  
\}  
  
【问题3】  
(1)\*p\_cmd\_port| = (QSPI\_FLASH\_ENABLE\_CMD&lt;&lt;24|1&lt;&lt;22)  
(2)\*p\_Id\_port = 0x01  
(3)\*p\_cmd\_port| = (QSPI\_FLASH\_ERASE\_CMD&lt;&lt;24|1&lt;&lt;22|1&lt;&lt;15)  
(4)\*p\_addr\_port = 0x1000  
(5)\*p\_Id\_port = 0x01  
【分析】 依据题意，在飞腾FT2000-4国产处理器上编写了一段对SPI\_Flash的擦除操作函数。在题干中对于如何擦除也进行了描述。  
在擦除函数QSPI\_FLASH\_ERASE中空(1)处,完成第一步:利用移位操作和或运算,对p\_cmd\_port 指针,运用QSPI\_FLASHI\_ENABLEI\_CMD,对QSPI中的CMDPORT寄存器的\[31:24\]位写入使能命令,并置位bit22。具体如下:  
\*-port=(QSPI\_FLASH\_ENABLE\_CMD&lt;&lt;24/1&lt;&lt;22);  
在空(2)处,完成第二步:利用p\_Id\_port 指针,对LDPORT寄存器写入0x01。具体如下：  
\*p\_Id\_port=0x01;  
然后利用移位操作和或运算,对p\_cmd\_port 指针,运用QSPIFLASH\_ERASE\_CMD,对QSPI中的CMD\_PORT寄存器的\[31:24\]位写入擦除命令,并置位bit22和bit15。具体如下:  
\*p\_cmd\_port|=(QSPI\_FLASH\_ERASECMD&lt;&lt;24|1&lt;&lt;22|1&lt;&lt;15);  
对ADDR\_PORT寄存器中写入要擦除的地址,利用p\_addr\_port 指针,对ADDR\_PORT 寄存器写入0x10000。具体如下:  
\*p\_addr\_port=0x10000;  
利用p\_Id\_port 指针,对LD\_PORT寄存器写入0x01。具体如下:  
\*p\_Id\_port=0x01;  
依据题干的描述，通过以上操作，就完成了对SPI Flash的擦除操作。  



[b26082b4d576434592e85245be5c3b99.jpg]: https://www.xkxxkx.cn/file/exam/software/嵌入式系统设计师/案例/第1题/b26082b4d576434592e85245be5c3b99.jpg
[74bae0cb55f54b42b6687859f1cedae5.jpg]: https://www.xkxxkx.cn/file/exam/software/嵌入式系统设计师/案例/第3题/74bae0cb55f54b42b6687859f1cedae5.jpg
[9ea9a98259544923a8e281edbdd169bf.jpg]: https://www.xkxxkx.cn/file/exam/software/嵌入式系统设计师/案例/第3题/9ea9a98259544923a8e281edbdd169bf.jpg
[ebc77ddc05fd4b98a59bcb61fbe20f19.jpg]: https://www.xkxxkx.cn/file/exam/software/嵌入式系统设计师/案例/第4题/ebc77ddc05fd4b98a59bcb61fbe20f19.jpg
[0523d9add5984681893d46e7cced19ce.jpg]: https://www.xkxxkx.cn/file/exam/software/嵌入式系统设计师/案例/第5题/0523d9add5984681893d46e7cced19ce.jpg
